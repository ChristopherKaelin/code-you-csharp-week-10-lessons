using System.Collections.Generic;
using System.IO;
using Newtonsoft.Json;



void Unit_9()
{
    //  Say hi
    Console.WriteLine("\n==================================");
    Console.WriteLine("Hello, World!. Welcome to Unit 9");
    Console.WriteLine("==================================\n");

    var currentDirectory = Directory.GetCurrentDirectory();
    var storesDir = Path.Combine(currentDirectory, "stores");

    var salesTotalDir = Path.Combine(currentDirectory, "salesTotalDir");
    Directory.CreateDirectory(salesTotalDir);

    var salesFiles = FindFiles(storesDir, "sales.json");

    var salesTotal = CalculateSalesTotal(salesFiles);

    File.AppendAllText(Path.Combine(salesTotalDir, "totals.txt"), $"{salesTotal}{Environment.NewLine}");

    Console.WriteLine($"\n");


    //  ====================
    IEnumerable<string> FindFiles(string folderName, string fileSearch, bool byName = true)
    {
        List<string> salesFiles = new List<string>();

        var foundFiles = Directory.EnumerateFiles(folderName, "*", SearchOption.AllDirectories);

        foreach (var file in foundFiles)
        {
            // The file name will contain the full path, so only check the end of it
            if (byName && file.EndsWith(fileSearch))
            {
                salesFiles.Add(file);
            }
            else if (Path.GetExtension(file) == fileSearch)
            {
                salesFiles.Add(file);
            }
        }

        return salesFiles;
    }

    double CalculateSalesTotal(IEnumerable<string> salesFiles)
    {
        double salesTotal = 0;

        // Loop over each file path in salesFiles
        foreach (var file in salesFiles)
        {
            // Read the contents of the file
            string salesJson = File.ReadAllText(file);

            // Parse the contents as JSON
            SalesData? data = JsonConvert.DeserializeObject<SalesData?>(salesJson);

            // Add the amount found in the Total field to the salesTotal variable
            salesTotal += data?.Total ?? 0;
        }

        return salesTotal;
    }

    record SalesData(double Total);
}


void Unit_7()
{
    //  Say hi
    Console.WriteLine("\n==================================");
    Console.WriteLine("Hello, World!. Welcome to Unit 7");
    Console.WriteLine("==================================\n");

    string currentDirectory = Directory.GetCurrentDirectory();
    var storesDirectory = Path.Combine(currentDirectory, "stores");

    var salesTotalDir = Path.Combine(currentDirectory, "salesTotalDir");
    Directory.CreateDirectory(salesTotalDir);   // Add this line of code

    var salesFiles = FindFiles(storesDirectory, "sales.json");

    File.WriteAllText(Path.Combine(salesTotalDir, "totals.txt"), String.Empty);

    Console.WriteLine();


    Console.WriteLine($"\n");
}


void Unit_5()
{
    //  Say hi
    Console.WriteLine("\n==================================");
    Console.WriteLine("Hello, World!. Welcome to Unit 5");
    Console.WriteLine("==================================");

    //  List files in the specified directory
    var currentDirectory = Directory.GetCurrentDirectory();
    var storesDirectory = Path.Combine(currentDirectory, "stores");
    var fileSearch = "sales.json";

    Console.WriteLine($"\nHere are the {fileSearch} files in the {storesDirectory} directorty.");
    var salesFilesList = FindFiles(storesDirectory, fileSearch, true);
    foreach (var file in salesFilesList)
    {
        Console.WriteLine(file);
    }

    Console.WriteLine("\n");
}


void Unit_3()
{
    //  Say hi
    Console.WriteLine("\n==================================");
    Console.WriteLine(" Hello, World!. Welcome to Unit 3 ");
    Console.WriteLine("==================================");

    //  List files in the specified directory
    string salesPath = Path.Combine("stores", "201");
    var fileSearch = "sales.json";
    Console.WriteLine($"\nHere are the {fileSearch} files in the {salesPath} directorty.");
    var salesFilesList = FindFiles(salesPath, fileSearch);
    foreach (var file in salesFilesList)
    {
        Console.WriteLine(file);
    }

}


